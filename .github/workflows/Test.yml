name: Crawling Test

on:
  workflow_dispatch:
    branches: "dev"
jobs:
  scrape:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3
      - name: Use Node.js 18
        uses: actions/setup-node@v3
        with:
          node-version: 18.x
          cache: "npm"
      - name: Get secrets
        run: |
          echo 123456:ABC-DEF1234ghIkl-zyx57W2v1u123ew11 > ./bot_token
      - name: Install sing-box
        run: |
          mkdir ./bin
          curl "https://github.com/SagerNet/sing-box/releases/download/v1.1/sing-box-1.1-linux-amd64.tar.gz" -L -o ./bin/sing-box.tar.gz
          tar -xf ./bin/sing-box.tar.gz -C ./bin
          rm -rf ./bin/sing-box.tar.gz
          mv ./bin/sing-box-1.1-linux-amd64/* ./bin/
      - name: Start Crawling
        env:
          DATA: '{"url": "", "filename": "1"}'
        run: |
          npm install && npx tsc && node ./app/index.js $DATA
